<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Final Album & Chat App</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* Reset & Global */
html, body {
  margin:0; padding:0;
  font-family:'Poppins',sans-serif;
  height:100%; width:100%;
  overflow:hidden;
  background:linear-gradient(135deg,#ffd6e8,#ffb3d1,#ff99c7);
  display:flex; justify-content:center; align-items:center;
  color:#333;
  line-height:1.6;
}

/* Particle Background */
#particleContainer{
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  overflow:hidden; z-index:0;
}
.particle{
  position:absolute; width:8px; height:8px;
  background:rgba(255,182,193,0.35);
  transform:rotate(45deg); border-radius:50%;
  animation-name:float; animation-timing-function:linear;
  animation-iteration-count:infinite;
  opacity:0;
  animation-fill-mode:forwards;
}
@keyframes float{
  0%{transform:translate(0,0) rotate(45deg) scale(0.5);opacity:0;}
  20%{opacity:0.6;}
  80%{opacity:0.4;}
  100%{transform:translate(var(--x), var(--y)) rotate(45deg) scale(1.2);opacity:0;}
}

/* Navbar */
.navbar{
  position:fixed; top:0; left:0;
  width:100%;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  display:flex; justify-content:center; align-items:center;
  padding:12px 0; z-index:1000;
  box-shadow:0 2px 15px rgba(0,0,0,0.1);
  display:none;
}
.navbar ul{
  list-style:none; display:flex; gap:20px; margin:0; padding:0; align-items:center;
}
.navbar button{
  background:none; border:none; color:white; font-size:1em;
  cursor:pointer; letter-spacing:1px; position:relative; transition:color 0.3s;
  font-weight:600; padding: 5px 10px;
}
.navbar button::after{
  content:''; position:absolute; left:0; bottom:-5px; width:0%; height:2px;
  background:#ffc0de; transition:width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
.navbar button:hover{ color:#ffe3f1; }
.navbar button:hover::after{ width:100%; }
.menu-toggle{ display:none; flex-direction:column; cursor:pointer; position:absolute; right:20px; top:14px; }
.menu-toggle span{ width:25px; height:3px; background:white; margin:4px 0; border-radius:2px; transition:0.3s; }
@media(max-width:700px){
  .navbar ul{ flex-direction:column; background:rgba(255,255,255,0.15);
    position:fixed; top:55px; right:-100%; width:60%; height:100vh;
    text-align:center; transition:right 0.4s ease; padding-top:60px;
    box-shadow:-5px 0 15px rgba(0,0,0,0.1); gap: 25px;
  }
  .navbar ul.active{ right:0; }
  .menu-toggle{ display:flex; }
  .menu-toggle.active span:nth-child(1){ transform:rotate(-45deg) translate(-5px, 6px); }
  .menu-toggle.active span:nth-child(2){ opacity:0; }
  .menu-toggle.active span:nth-child(3){ transform:rotate(45deg) translate(-5px, -6px); }
}

/* Page */
.page{
  width:100%; height:100%;
  display:none; justify-content:center; align-items:center; flex-direction:column;
  opacity:0; transition:opacity 0.8s ease-in-out;
  position:absolute; top:0; left:0;
}
.active-page{ display:flex; opacity:1; }

/* Album */
.album-wrapper{ position:relative; text-align:center; width:90%; max-width:700px; z-index:2; opacity:0; transition:opacity 1.2s ease; }
.album-wrapper.show{ opacity:1; }
.folder-album-wrapper{ opacity:1; } 
.romantic-text{ font-size:2em; margin-bottom:20px; text-shadow:0 0 20px rgba(255,255,255,0.6); color:#fff; font-weight:700; }
.album-container{
  position:relative; width:100%; height:650px;
  border-radius:25px; overflow:hidden;
  border:2px solid rgba(255,255,255,0.3);
  background:rgba(255,255,255,0.07);
  backdrop-filter:blur(12px);
  box-shadow:0 15px 35px rgba(0,0,0,0.3);
  touch-action:pan-x;
  display:flex; justify-content:center; align-items:center; 
}
.photo{
  width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0;
  opacity:0; transition:opacity 1.3s ease-in-out, transform 1.3s ease-in-out, box-shadow 1.3s ease-in-out;
  border-radius:20px; box-shadow:0 0 0px rgba(255,192,222,0);
}
.photo.active{ opacity:1; z-index:2; transform:scale(1.03); box-shadow:0 0 40px rgba(255,192,222,0.6); }
.nav-btn{
  position:absolute; top:50%; transform:translateY(-50%);
  font-size:2em; color:white; background:rgba(255,255,255,0.2);
  border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; z-index:3; transition:background 0.3s, transform 0.3s;
  display:flex; justify-content:center; align-items:center;
}
.nav-btn:hover{ background:rgba(255,255,255,0.4); transform:translateY(-50%) scale(1.1); }
.prev-btn{ left:10px; } .next-btn{ right:10px; }

/* Photo Indicator (Dots) */
.photo-indicator{
  display:flex; justify-content:center; margin-top:15px; gap:8px; z-index:4;
}
.dot{
  width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.4);
  cursor:pointer; transition:all 0.3s; border:1px solid rgba(255,255,255,0.2);
}
.dot.active{
  background:#ffc0de; width:12px; height:12px;
  transform:scale(1.1); box-shadow:0 0 10px rgba(255,192,222,0.8);
}
.dot:hover{
  background:#ffb3d1; transform:scale(1.2);
}


/* Menu bawah foto */
.photo-menu{
  position:relative;
  margin-top:20px;
  display:flex; gap:20px; justify-content:center; background:rgba(255,255,255,0.15);
  padding:10px 20px; border-radius:25px; backdrop-filter:blur(10px); z-index:4;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}
.photo-menu button{
  background:none; border:none; color:white; font-size:1em; cursor:pointer; transition:0.3s;
  position:relative; font-weight:600;
  display:flex; align-items:center; gap:5px;
}
.photo-menu button:hover{ color:#ffb3d1; transform:scale(1.05); }

/* Info Box */
.info-box{ background: rgba(255,255,255,0.08); backdrop-filter: blur(10px);
  padding:30px; border-radius:20px; color:#fff; text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); max-width:500px;
  animation: fadeInScale 0.8s forwards ease-out;
}
.info-box h2{ color:#ffe3f1; font-weight:700; margin-bottom:15px; }
.info-box p{ font-size:1.1em; margin-bottom:10px; }
.info-box a{ color:#ffc0de; text-decoration:none; font-weight:bold; }
.info-box a:hover{ text-decoration:underline; }

/* Login */
#loginPage{
  width:100%; height:100%; display:flex; justify-content:center; align-items:center;
  flex-direction:column; z-index:1000;
}
#loginTitle{
  color:#fff; font-size:2.5em; margin-bottom:25px; text-shadow:0 0 25px rgba(255,255,255,0.8); text-align:center;
  font-weight:700; animation: bounceIn 1s ease-out;
}
#loginBox{
  background:rgba(255,255,255,0.1); backdrop-filter:blur(12px);
  padding:40px 30px; border-radius:25px; box-shadow:0 15px 40px rgba(0,0,0,0.3);
  display:flex; flex-direction:column; gap:20px; width:300px; max-width:90%;
  animation: fadeInScale 0.8s forwards ease-out 0.2s; opacity:0;
}
#loginBox input{
  padding:14px 18px; border-radius:18px; border:1px solid rgba(255,255,255,0.3); outline:none;
  font-size:1em; background:rgba(255,255,255,0.2); color:white;
  transition:border-color 0.3s, background 0.3s;
}
#loginBox input::placeholder{ color:rgba(255,255,255,0.7); }
#loginBox input:focus{ border-color:#ffb3d1; background:rgba(255,255,255,0.3); }
#loginBox button{
  padding:14px; border:none; border-radius:18px;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1.1em; box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
#loginBox button:hover{ background:#ffb3d1; transform:translateY(-2px); box-shadow:0 7px 20px rgba(0,0,0,0.3); }
.show-pass{
  position:relative; color:#fff; font-size:0.9em; cursor:pointer; text-align:right; margin-top:-10px;
  transition:color 0.3s;
}
.show-pass:hover{ color:#ffc0de; }
#loginError{color:#ffb3b3; font-size:0.9em; text-align:center; display:none; margin-top:-10px;}

/* Welcome Message */
#welcomeMessage{
  background:rgba(255,255,255,0.1); backdrop-filter:blur(12px);
  padding:30px; border-radius:20px; color:#fff; text-align:center;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); max-width:400px;
  animation: fadeInScale 0.8s forwards ease-out; opacity:0;
  display:none; flex-direction:column; gap:20px;
}
#welcomeMessage h2{ font-size:2em; color:#ffe3f1; margin-bottom:10px; }
#welcomeMessage p{ font-size:1.1em; }
#welcomeMessage button{
  padding:12px 25px; border-radius:15px; border:none;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1em; box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
#welcomeMessage button:hover{ background:#ffb3d1; transform:translateY(-2px); box-shadow:0 7px 20px rgba(0,0,0,0.3); }

/* Tombol Kembali */
.back-btn{
  position:fixed; top:20px; left:20px; z-index:100;
  padding:10px 15px; border-radius:10px; border:none;
  background:rgba(255,255,255,0.2); backdrop-filter:blur(5px);
  color:white; font-weight:bold; cursor:pointer; transition:0.3s, transform 0.3s;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
  display:flex; align-items:center; gap:5px;
}
.back-btn:hover{ background:rgba(255,255,255,0.4); transform:translateY(-2px); }

/* Tombol Folder */
.folder-btn{
  padding:18px 25px; border:none; border-radius:20px;
  background:#ff99c7; color:white; font-weight:bold; cursor:pointer; transition:0.3s;
  font-size:1.2em; letter-spacing:1px;
  box-shadow:0 5px 20px rgba(0,0,0,0.2);
  display:flex; justify-content:center; align-items:center;
  gap:10px;
  animation: fadeInScale 0.6s forwards ease-out; opacity:0;
}
.folder-btn:hover{ background:#ffb3d1 !important; transform:scale(1.03) translateY(-3px); box-shadow:0 8px 25px rgba(0,0,0,0.3); }
#folder1Btn{ animation-delay:0.2s; }
#folder2Btn{ animation-delay:0.4s; }

/* Loading Spinner */
.loading-spinner {
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-top: 4px solid #ffc0de;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1; 
}
@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Fallback Image Style */
.fallback-img {
    background-color: #f0f0f0;
    color: #888;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2em;
    text-align: center;
    border-radius: 20px;
    border: 2px dashed #ccc;
}


/* Animations */
@keyframes fadeInScale {
  0% { opacity: 0; transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}
@keyframes bounceIn {
  0% { opacity: 0; transform: scale(0.3); }
  50% { opacity: 1; transform: scale(1.05); }
  70% { transform: scale(0.9); }
  100% { transform: scale(1); }
}

/* Responsive */
@media(max-width:600px){
  .romantic-text{ font-size:1.8em; margin-bottom:15px; }
  .album-container{ height:400px; border-radius:15px; }
  .photo{ border-radius:10px; }
  .nav-btn{ width:40px; height:40px; font-size:1.5em; }
  .prev-btn{ left:5px; } .next-btn{ right:5px; }
  .back-btn{ top:10px; left:10px; padding:8px 12px; font-size:0.9em; }
  #loginTitle{ font-size:2em; margin-bottom:20px; }
  #loginBox{ padding:30px 20px; }
  .folder-btn{ font-size:1em; padding:12px 20px; }
  .photo-menu{ margin-top:15px; padding:8px 15px; }
  .photo-menu button{ font-size:0.9em; }
  #welcomeMessage h2{ font-size:1.8em; }
  #welcomeMessage p{ font-size:1em; }
}

/* PENAMBAHAN 4: CHAT STYLING (Di Akhir CSS) */
#chatPage .info-box {
    max-width: 600px;
    height: 80vh; 
    display: flex;
    flex-direction: column;
    padding: 0;
}
#chatHeader {
    padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1);
    backdrop-filter: blur(8px);
}
#chatMessages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
    background: rgba(255,255,255,0.05);
}
#chatMessages::-webkit-scrollbar {
    width: 6px;
}
#chatMessages::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}
.chat-bubble {
    transition: all 0.3s ease;
    position: relative;
}
.message-status {
    font-size: 1em !important; 
    margin-left: 3px; 
    vertical-align: middle;
}

/* --- Penambahan untuk Logout & Status --- */

/* Navbar - Tambahan untuk tombol Logout */
.navbar button#logoutBtn{
  background:#ff6f91; color:white; border-radius:15px; padding:8px 15px;
  box-shadow:0 3px 10px rgba(255,111,145,0.5);
  transition: transform 0.3s;
}
.navbar button#logoutBtn:hover{
  background:#ff8da8; transform:scale(1.05); color:white;
}
.navbar button#logoutBtn::after{
  display:none;
}
/* Chat Delete Button (DIUBAH UNTUK OPSI HAPUS UNTUK SEMUA ORANG) */
.delete-chat-menu {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff6f91;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    font-size: 16px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s;
    line-height: 25px;
    text-align: center;
    z-index: 5;
    display: flex; align-items: center; justify-content: center;
}
.chat-bubble:hover .delete-chat-menu {
    opacity: 1;
}

/* Styling Menu Hapus */
.delete-options {
    position: absolute;
    top: 25px;
    right: 5px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 10;
    padding: 5px 0;
    display: none;
    min-width: 150px;
}
.delete-options button {
    background: none;
    border: none;
    padding: 8px 15px;
    width: 100%;
    text-align: left;
    color: #333;
    font-size: 0.9em;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
}
.delete-options button:hover {
    background: #f0f0f0;
}

/* Status Page Styling */
#statusPage .info-box {
    max-width: 500px;
    height: auto;
    min-height: 400px;
    padding: 30px;
    display: flex;
    flex-direction: column;
}
#statusList {
    margin-top: 20px;
    width: 100%;
    max-height: 400px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 10px;
}
.status-item {
    padding: 15px;
    border-radius: 15px;
    background: rgba(255,255,255,0.1);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: background 0.3s, border-left 0.3s;
    position: relative;
    border-left: 5px solid #ff99c7; /* Belum dilihat */
}
.status-item.viewed {
    border-left: 5px solid rgba(255,255,255,0.3); /* Sudah dilihat */
    background: rgba(255,255,255,0.05);
}
.status-item:hover {
    background: rgba(255,255,255,0.2);
}

/* Tombol Hapus Status */
.delete-status-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background: #ff6f91;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    font-size: 14px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s;
    line-height: 25px;
    text-align: center;
    z-index: 5;
    display: flex; align-items: center; justify-content: center;
}
.status-item:hover .delete-status-btn {
    opacity: 1;
}


.status-meta {
    display: flex; justify-content: space-between; align-items: center;
    font-size: 0.85em; color: rgba(255,255,255,0.7); margin-top: 5px;
}
.status-meta .viewed-icon {
    display: flex; align-items: center; gap: 5px; color: #7aff7a; font-weight: 600;
}
/* Status Viewer */
#statusViewer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.9); z-index: 2000;
    display: none; justify-content: center; align-items: center;
    flex-direction: column;
}
#viewerContent {
    background: #111; padding: 20px; border-radius: 15px; max-width: 90%; width: 400px;
    color: white; animation: fadeInScale 0.5s;
}
#statusReplyInput {
    padding: 10px; border-radius: 10px; border: none; width: 80%; margin-right: 10px;
    background: rgba(255,255,255,0.9); color: #333;
}
#statusLikeBtn, #statusReplyBtn {
    padding: 10px 15px; border-radius: 10px; border: none; background: #ff99c7; color: white; margin-top: 10px; cursor: pointer; transition: 0.3s;
}
#statusLikeBtn:hover, #statusReplyBtn:hover { background: #ffb3d1; }

/* Styling Media Chat */
.media-message {
    max-width: 200px; 
    max-height: 200px;
    border-radius: 10px;
    object-fit: contain;
    margin-top: 5px;
    display: block;
}

/* Styling Media Status */
#viewerMedia {
    max-width: 100%;
    max-height: 300px;
    object-fit: contain;
    border-radius: 10px;
    margin-bottom: 15px;
}
</style>
</head>
<body>

<div id="particleContainer"></div>

<nav class="navbar">
  <div class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></div>
  <ul id="navMenu">
    <li><button id="homeBtn"><span class="material-icons">home</span> Home</button></li> 
    <li><button id="chatNavBtn"><span class="material-icons">message</span> Chat</button></li> 
    <li><button id="statusNavBtn"><span class="material-icons">auto_stories</span> Status</button></li> 
    <li><button id="aboutBtn"><span class="material-icons">info</span> About</button></li> 
    <li><button id="contactBtn"><span class="material-icons">email</span> Contact</button></li> 
    <li><button id="logoutBtn"><span class="material-icons">logout</span> Logout</button></li>
  </ul>
</nav>

<div class="page active-page" id="loginPage">
  <div id="loginTitle">ğ—Ÿğ—¢ğ—šğ—œğ—¡ ğ—¨ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ—”ğ—§ ğ—”ğ—Ÿğ—•ğ—¨ğ— </div>
  <div id="loginBox">
    <input type="text" id="username" placeholder="Username"> <input type="password" id="password" placeholder="Password"> <div class="show-pass" id="togglePass">Show Password</div>
    <button id="loginBtn">Login</button>
    <div id="loginError">Username atau Password salah!</div>
  </div>
</div>

<div class="page" id="welcomePage">
  <div id="welcomeMessage">
    <h2>Selamat Datang! âœ¨</h2>
    <p>Halo <span id="displayUsername"></span>, senang Anda kembali! Jelajahi momen spesial dalam album digital ini.</p>
    <button id="startBrowsingBtn">Mulai Jelajahi Album</button>
  </div>
</div>

<div class="page" id="homePage">
  <div class="album-wrapper" id="folderSelectWrapper" style="display:flex; flex-direction:column; gap:20px; max-width:400px; padding:20px; opacity:1;">
    <div class="romantic-text" style="margin-bottom:0;">ğ—£ğ—œğ—Ÿğ—œğ—› ğ—™ğ—¢ğ—Ÿğ——ğ—˜ğ—¥ ğ—”ğ—Ÿğ—•ğ—¨ğ— </div>
    <button id="mainAlbumBtn" class="folder-btn">
        <span class="icon"></span> ALBUM UTAMA
    </button>
    <button id="folder1Btn" class="folder-btn">
        <span class="icon"></span> PAP RANDOM 1
    </button>
    <button id="folder2Btn" class="folder-btn">
        <span class="icon"></span> PAP RANDOM 2 
    </button>
  </div>
  
  <div class="album-wrapper" id="albumWrapper" style="display:none;">
    <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
    <div class="romantic-text">ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ—”ğ—§ ğ…ğ—¢ğ—§ğ—¢ ğ’ğ„ğ—Ÿğ—”ğ—¡ğ—ğ—¨ğ—§ğ—¡ğ—¬ğ€</div>
    <div class="album-container" id="albumContainer">
      <div class="loading-spinner" id="mainSpinner"></div>
    </div>
    <div class="photo-indicator" id="mainPhotoIndicator"></div>
    <div class="photo-menu" id="photoMenu">
      <button id="shareBtn"><span class="icon"></span> Share</button>
      <button id="likeBtn"><span class="icon"></span> Like</button>
      <button id="downloadBtn"><span class="icon"></span> Download</button>
    </div>
    <button class="nav-btn prev-btn" id="prevBtn">&#10094;</button>
    <button class="nav-btn next-btn" id="nextBtn">&#10095;</button>
  </div>
</div>

<div class="page" id="folder1Page">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="album-wrapper folder-album-wrapper" data-folder="folder1">
    <div class="romantic-text">ğ…ğğ‹ğƒğ„ïº­ ğŸ - ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ—”ğ—§ ğ…ğ—¢ğ—§ğ—¢</div>
    <div class="album-container folder-album-container" id="folder1Container">
      <div class="loading-spinner" id="folder1Spinner"></div>
    </div>
    <div class="photo-indicator folder-photo-indicator" id="folder1PhotoIndicator"></div>
    <div class="photo-menu">
      <button onclick="sharePhoto('folder1')"><span class="icon"></span> Share</button>
      <button class="like-btn" data-folder="folder1"><span class="icon"></span> Like</button>
      <button onclick="downloadPhoto('folder1')"><span class="icon"></span> Download</button>
    </div>
    <button class="nav-btn prev-btn" onclick="navPhoto('folder1', -1)">&#10094;</button>
    <button class="nav-btn next-btn" onclick="navPhoto('folder1', 1)">&#10095;</button>
  </div>
</div>

<div class="page" id="folder2Page">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="album-wrapper folder-album-wrapper" data-folder="folder2">
    <div class="romantic-text">ğ…ğğ‹ğƒğ„ğ‘ ğŸ - ğ’ğ–ğˆğğ„ ğ”ğ—¡ğ—§ğ—¨ğ— ğ— ğ—˜ğ—Ÿğ—œğ—›ğ—”ğ—§ ğ…ğ—¢ğ—§ğ—¢</div>
    <div class="album-container folder-album-container" id="folder2Container">
      <div class="loading-spinner" id="folder2Spinner"></div>
    </div>
    <div class="photo-indicator folder-photo-indicator" id="folder2PhotoIndicator"></div>
    <div class="photo-menu">
      <button onclick="sharePhoto('folder2')"><span class="icon"></span> Share</button>
      <button class="like-btn" data-folder="folder2"><span class="icon"></span> Like</button>
      <button onclick="downloadPhoto('folder2')"><span class="icon"></span> Download</button>
    </div>
    <button class="nav-btn prev-btn" onclick="navPhoto('folder2', -1)">&#10094;</button>
    <button class="nav-btn next-btn" onclick="navPhoto('folder2', 1)">&#10095;</button>
  </div>
</div>

<div class="page" id="aboutPage">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="info-box">
    <h2>About</h2>
    <p>Developer: <strong>Nando Developers</strong></p>
    <p>ğ€ğ‹ğğ—¨ğ—  ğƒğˆğ—šğ—œğ—§ğ—”ğ—Ÿ ğğ˜ ğ‚ğ—˜ğ—Ÿğ—­</p>
    <p>Versi: 3.2 Final
  </div>
</div>

<div class="page" id="contactPage">
  <button class="back-btn" onclick="showPage('home')">&#10094; KEMBALI</button>
  <div class="info-box">
    <h2>Contact</h2>
    <p>Email: <a href="mailto:arcelbussines@email.com">arcelbussines@email.com</a></p>
    <p>Telegram: <a href="https://t.me/humans26" target="_blank">@humans26</a></p>
    <p>Jangan sungkan untuk menghubungi kami!</p>
  </div>
</div>

<div class="page" id="chatPage">
    <button class="back-btn" onclick="showPage('home')">
        <span class="material-icons">arrow_back</span> KEMBALI
    </button>
    <div class="info-box" style="max-width: 600px; height: 80vh; padding: 0; display: flex; flex-direction: column;">
        
        <div id="chatHeader" style="padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.2); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.1);">
            <div id="opponentAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: #ffc0de; color: white; display: flex; justify-content: center; align-items: center; font-weight: 700; font-size: 1.2em;"></div>
            <div>
                <h3 id="opponentName" style="margin: 0; color: #ffe3f1; font-weight: 700; font-size: 1.2em;">Memuat...</h3>
                <p id="chatStatus" style="margin: 0; font-size: 0.8em; color: rgba(255,255,255,0.7);">Menghubungkan...</p>
            </div>
        </div>

        <div id="chatMessages" style="flex-grow: 1; overflow-y: auto; padding: 20px; text-align: left; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth;">
            <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8em;">-- Chat hanya berfungsi jika server backend berjalan di localhost:3000 --</div>
        </div>

        <div style="padding: 15px; border-top: 1px solid rgba(255,255,255,0.2); display: flex; gap: 10px; align-items: center;">
            
            <button id="attachMediaBtn" style="padding: 10px; border-radius: 50%; width: 40px; height: 40px; background: #99c7ff; color: white; border: none; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <span class="material-icons" style="font-size: 1.2em;">attach_file</span>
            </button>
            <input type="file" id="chatFileInput" accept="image/*" style="display:none;">
            <input type="text" id="chatInput" placeholder="Ketik pesan..." style="flex-grow: 1; padding: 12px 18px; border-radius: 20px; border: none; background: rgba(255,255,255,0.5); color: #333; outline: none;">
            
            <button id="sendChatBtn" style="padding: 10px 15px; border-radius: 50%; width: 40px; height: 40px; background: #ff99c7; color: white; border: none; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <span class="material-icons" style="font-size: 1.2em;">send</span>
            </button>
        </div>
    </div>
</div>

<div class="page" id="statusPage">
    <button class="back-btn" onclick="showPage('home')">
        <span class="material-icons">arrow_back</span> KEMBALI
    </button>
    <div class="info-box">
        <h2>Stories (Status) âœ¨</h2>
        
        <button id="createMediaStatusBtn" class="folder-btn" style="width:100%; margin-top:10px; background:#4CAF50;">
            <span class="material-icons">add_box</span> Buat Status Media Baru
        </button>
        <input type="file" id="statusFileInput" accept="image/*" style="display:none;">
        <div id="statusList">
            <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.9em;">Memuat status...</div>
        </div>
    </div>
</div>

<div id="statusViewer">
    <div id="viewerContent">
        <h3 id="viewerHeader" style="color:#ffc0de;">Status dari <span id="viewerSender"></span> <span id="viewerTime" style="font-size: 0.6em; color: rgba(255,255,255,0.5);"></span></h3>
        
        <img id="viewerMedia" src="" alt="Status Media" style="display:none;">
        <p id="viewerMessage" style="font-size:1.1em; margin: 15px 0;"></p>
        
        <div id="viewerMeta">
            <p id="viewerLikes"><span class="material-icons" style="font-size:0.9em; vertical-align:middle;">favorite</span> <span id="likeCount">0</span> Suka</p>
            <p id="viewerViews"><span class="material-icons" style="font-size:0.9em; vertical-align:middle;">visibility</span> <span id="viewCount">0</span> Dilihat</p>
        </div>
        
        <div style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
             <button id="statusLikeBtn"><span class="material-icons" style="font-size: 1.1em; vertical-align:middle;">favorite</span> Like</button>
             <button id="statusReplyBtn"><span class="material-icons" style="font-size: 1.1em; vertical-align:middle;">reply</span> Reply</button>
        </div>

        <div id="replySection" style="margin-top: 20px; display: none; align-items: center; gap: 10px;">
            <input type="text" id="statusReplyInput" placeholder="Kirim balasan...">
            <button id="sendReplyBtn" style="padding: 10px; border-radius: 50%; width: 40px; height: 40px; background: #00bcd4; color: white; border: none; cursor: pointer; display: flex; justify-content: center; align-items: center;">
                <span class="material-icons">send</span>
            </button>
        </div>

        <button onclick="document.getElementById('statusViewer').style.display='none';" style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:2em; cursor:pointer;">&times;</button>
    </div>
</div>

<audio id="bgMusic" src="https://h.top4top.io/m_35969emdf0.m4a" loop></audio>

<script>
// --- KONFIGURASI CHAT & LOGIN ---
const CHAT_SERVER_URL = 'http://localhost:3000'; 
const socket = io(CHAT_SERVER_URL); 

// 2 AKUN LOGIN STATIS (HARUS SESUAI DENGAN SERVER.JS)
const loginCredentials = {
  'zaza': 'zaza',      
  'khirza': 'cantik'   
};
const CHAT_USER_PROFILES = {
    'zaza': { id: 'zaza', name: 'Zaza', isVerified: true, avatar: 'ZA' },
    'khirza': { id: 'khirza', name: 'Khirza', isVerified: false, avatar: 'KH' }
};

let myUserId = ''; 
let myUserName = '';
let opponentInfo = {}; 
const STATUS_KEY = 'globalUserStatuses'; 
let currentStatusId = null; 
// --- END KONFIGURASI ---

// Navbar toggle
const navMenu = document.getElementById('navMenu');
const menuToggle = document.getElementById('menuToggle');
menuToggle.addEventListener('click',()=> {
  navMenu.classList.toggle('active');
  menuToggle.classList.toggle('active');
});

// Pages (Diperbarui dengan 'status')
const pages = { 
  login: document.getElementById('loginPage'), 
  welcome: document.getElementById('welcomePage'),
  home: document.getElementById('homePage'), 
  folder1: document.getElementById('folder1Page'),
  folder2: document.getElementById('folder2Page'),
  about: document.getElementById('aboutPage'), 
  contact: document.getElementById('contactPage'),
  chat: document.getElementById('chatPage'),
  status: document.getElementById('statusPage') 
};

// **DATA ALBUM DIUBAH DENGAN LINK BARU DAN STRUKTUR DISSESUAIKAN**
const albumData = {
  main: { 
    photos: [
      "https://images2.imgbox.com/07/6d/flAblCPU_o.jpg",
      "https://images2.imgbox.com/8a/48/5WnFlheI_o.jpg",
      "https://images2.imgbox.com/17/93/x3zJwzr8_o.jpg",
      "https://images2.imgbox.com/9f/c4/0HZK3fj6_o.jpg",
      "https://images2.imgbox.com/d4/f3/y30RHo1v_o.jpg",
      "https://images2.imgbox.com/d0/ef/utCLLETK_o.jpg",
      "https://images2.imgbox.com/6d/9d/TfuuSkGT_o.jpg",
      "https://images2.imgbox.com/9b/14/1Nh4stjQ_o.jpg",
      "https://images2.imgbox.com/05/cf/2lmZVoK0_o.jpg",
      "https://images2.imgbox.com/17/ad/VpSegle2_o.jpg",
      "https://images2.imgbox.com/bf/38/j28lslL7_o.jpg",
      "https://images2.imgbox.com/2d/5d/THVip0wB_o.jpg",
      "https://images2.imgbox.com/d1/42/8VgLCjZp_o.jpg",
      "https://images2.imgbox.com/15/a4/Aj6Q76RP_o.jpg",
      "https://images2.imgbox.com/31/7d/DaZ3wHmd_o.jpg",
      "https://images2.imgbox.com/ac/73/goBnuRIx_o.jpg",
      "https://images2.imgbox.com/aa/b9/HsnXJMTE_o.jpg",
      "https://images2.imgbox.com/9d/1e/44qSzju4_o.jpg",
      "https://images2.imgbox.com/94/ec/28ile6qy_o.jpg",
      "https://images2.imgbox.com/b7/2c/3EgN6c1L_o.jpg",
      "https://images2.imgbox.com/09/6a/BJdQjfwc_o.jpg",
      "https://images2.imgbox.com/7a/11/Example22_o.jpg"
    ], 
    current: 0, liked: false, 
    container: document.getElementById('albumContainer'), 
    indicator: document.getElementById('mainPhotoIndicator'), 
    spinner: document.getElementById('mainSpinner'),
    likeBtnElement: document.getElementById('likeBtn') // Diisi di sini
  },
  folder1: { 
    photos: [ 
      "https://files.catbox.moe/a8103e.jpg",
      "https://files.catbox.moe/xrgsju.jpg",
      "https://files.catbox.moe/66gyub.jpg",
      "https://files.catbox.moe/kwhj0y.jpg",
      "https://files.catbox.moe/53xopd.jpg",
      "https://files.catbox.moe/vavwon.jpg",
      "https://files.catbox.moe/qs8hz8.jpg",
      "https://files.catbox.moe/vye5u2.jpg",
      "https://files.catbox.moe/62lajf.jpg",
      "https://files.catbox.moe/ieldvp.jpg"
    ], 
    current: 0, liked: false, 
    container: null, 
    indicator: null, 
    spinner: null,
    likeBtnElement: null
  },
  folder2: { 
    photos: [ 
      "https://files.catbox.moe/ieldvp.jpg",
      "https://files.catbox.moe/6ldfhh.jpg",
      "https://files.catbox.moe/250ug0.jpg",
      "https://files.catbox.moe/zklaxg.jpg",
      "https://files.catbox.moe/n5682x.jpg",
      "https://files.catbox.moe/rdgmp9.jpg"
    ], 
    current: 0, liked: false, 
    container: null, 
    indicator: null, 
    spinner: null,
    likeBtnElement: null
  }
};

let autoSwipeInterval;
let lastTap = 0; // Untuk double tap

// **FUNGSI UTAMA LOCAL STORAGE**
function getLocalStorageKey(key) { return `${myUserId}_${key}`; }

// **INICIALISASI SAAT STARTUP (SESI PERSISTENCE)**
window.onload = () => {
    // Inisialisasi likeBtnElement untuk folder 1 dan 2 setelah DOM dimuat
    albumData.folder1.likeBtnElement = document.querySelector('#folder1Page .like-btn');
    albumData.folder2.likeBtnElement = document.querySelector('#folder2Page .like-btn');
    
    // Tambahkan event listener untuk tombol like folder 1 & 2
    albumData.folder1.likeBtnElement.onclick = () => toggleLike('folder1');
    albumData.folder2.likeBtnElement.onclick = () => toggleLike('folder2');

    const storedUser = localStorage.getItem('loggedInUser');
    if (storedUser && loginCredentials[storedUser]) {
        myUserId = storedUser;
        myUserName = CHAT_USER_PROFILES[myUserId].name;
        document.querySelector('.navbar').style.display = 'flex';
        document.getElementById('displayUsername').textContent = myUserName.toUpperCase();
        showPage('welcome');
        socket.emit('user_login', myUserId);
    } else {
        showPage('login');
    }
};


// Login (Diperbarui)
const loginBtn = document.getElementById('loginBtn');
const loginError = document.getElementById('loginError');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const togglePass = document.getElementById('togglePass');
const albumWrapper = document.getElementById('albumWrapper'); 
const folderSelectWrapper = document.getElementById('folderSelectWrapper');
const music = document.getElementById('bgMusic');
const displayUsername = document.getElementById('displayUsername');
const startBrowsingBtn = document.getElementById('startBrowsingBtn');

togglePass.addEventListener('click', ()=>{
  passwordInput.type = (passwordInput.type==='password')?'text':'password'; 
  togglePass.textContent = (passwordInput.type==='password')?'Show Password':'Hide Password'; 
});

loginBtn.addEventListener('click', ()=>{
  const user = usernameInput.value.trim();
  const pass = passwordInput.value.trim();
  
  if(loginCredentials[user] === pass){ 
    loginError.style.display='none';
    document.querySelector('.navbar').style.display='flex';
    
    myUserId = user; 
    myUserName = CHAT_USER_PROFILES[user].name;
    localStorage.setItem('loggedInUser', user); 
    
    displayUsername.textContent = myUserName.toUpperCase(); 
    
    socket.emit('user_login', myUserId);
    
    showPage('welcome'); 
  } else {
    loginError.style.display='block';
  }
});

document.getElementById('startBrowsingBtn').addEventListener('click', () => { showPage('home'); });

// **LOGOUT** (DITAMBAH)
document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('loggedInUser'); 
    socket.emit('user_logout', myUserId); 
    myUserId = '';
    myUserName = '';
    document.querySelector('.navbar').style.display = 'none';
    music.pause();
    showPage('login');
});

// FUNGSI UTAMA UNTUK MENAMPILKAN HALAMAN (DIUBAH)
function showPage(page){
  // Hentikan auto-swipe saat berpindah halaman
  clearInterval(autoSwipeInterval);
  
  // 1. Matikan semua halaman dan hapus kelas aktif
  for(const key in pages){ 
    pages[key].style.display = 'none';
    pages[key].classList.remove('active-page');
  }

  // 2. Tampilkan halaman yang diminta
  if (page === 'home' || page === 'mainAlbum') {
      pages['home'].style.display = 'flex';
      pages['home'].classList.add('active-page');
      
      if (page === 'home') {
           folderSelectWrapper.style.display = 'flex'; 
           albumWrapper.style.display = 'none';
      } else { 
           folderSelectWrapper.style.display = 'none';
           albumWrapper.style.display = 'block'; 
      }
  } else {
      pages[page].style.display = 'flex'; 
      pages[page].classList.add('active-page'); 
  }
  
  // Nonaktifkan menu toggle saat mengganti halaman
  navMenu.classList.remove('active');
  menuToggle.classList.remove('active');
  
  // Khusus untuk Chat, muat history
  if (page === 'chat') {
      loadChatHistory();
  }
  // Khusus untuk Status, muat list
  if (page === 'status') {
      renderStatusList();
  }

  // Putar musik jika bukan halaman non-musik
  const nonMusicPages = ['login', 'welcome', 'about', 'contact', 'chat', 'status'];
  if(!nonMusicPages.includes(page)) playMusicIfAlbum();
  else music.pause();
}


// FUNGSI ALBUM (DIPERBAIKI UNTUK DATA BARU)

function showPhoto(folder, i){
    const data = albumData[folder];
    const container = data.container;
    const spinner = data.spinner;
    const photos = data.photos;

    // Hapus semua foto dan dot yang ada
    container.querySelectorAll('.photo').forEach(p => p.remove());
    data.indicator.innerHTML = '';
    
    if (photos.length === 0) {
        container.innerHTML = '<div class="fallback-img">Tidak ada foto di folder ini.</div>';
        return;
    }

    // Ambil status like dari localStorage
    data.liked = localStorage.getItem(getLocalStorageKey(`${folder}_liked`)) === 'true';

    spinner.style.display = 'block'; 

    photos.forEach((photoUrl, index) => { // photoUrl adalah string
        const img = document.createElement('img');
        img.className = 'photo';
        img.src = photoUrl;
        img.alt = `Photo ${index + 1}`;
        
        if (index === i) {
            img.classList.add('active');
            data.current = i; 
        }

        img.onload = () => {
             // Jika foto yang baru dimuat adalah foto pertama/aktif, sembunyikan spinner
            if (index === i) {
                spinner.style.display = 'none';
            }
        };

        img.onerror = () => {
            console.error(`Gagal memuat foto: ${photoUrl}`);
            // Tambahkan fallback jika gambar gagal dimuat
            const fallback = document.createElement('div');
            fallback.className = 'photo active fallback-img';
            fallback.style.cssText = `z-index: ${index === i ? 2 : 0};`;
            fallback.textContent = `Foto ${index + 1} Gagal Dimuat`;
            container.appendChild(fallback);
             if (index === i) {
                spinner.style.display = 'none';
            }
        };
        
        container.appendChild(img);
        
        const dot = document.createElement('span');
        dot.className = 'dot';
        if (index === i) dot.classList.add('active');
        dot.onclick = () => {
            resetAutoSwipe(folder);
            showPhoto(folder, index);
            startAutoSwipe(folder);
        };
        data.indicator.appendChild(dot);
    });

    // Perbarui status like menggunakan likeBtnElement
    updateLikeButton(data.likeBtnElement, data.liked);
}

function navPhoto(folder, direction){
    const data = albumData[folder];
    let newIndex = data.current + direction;
    
    if (newIndex < 0) newIndex = data.photos.length - 1;
    if (newIndex >= data.photos.length) newIndex = 0;
    
    resetAutoSwipe(folder);
    showPhoto(folder, newIndex);
    startAutoSwipe(folder);
}


function initMainAlbum(){
    const data = albumData['main'];
    // Ambil status like dari localStorage saat inisialisasi
    data.liked = localStorage.getItem(getLocalStorageKey('main_liked')) === 'true';
    
    // Pastikan container dan indicator kosong saat inisialisasi
    data.container.innerHTML = `<div class="loading-spinner" id="mainSpinner"></div>`;
    data.indicator.innerHTML = '';
    showPhoto('main', data.current);
    setupSwipe(data.container, 'main');
    setupDoubleTap(data.container, 'main'); // **TIDAK ADA PERUBAHAN DI SINI**
    startAutoSwipe('main');
    document.getElementById('albumWrapper').classList.add('show');
}

function initFolderAlbum(folder){
    const data = albumData[folder];
    // Pastikan container dan indicator dikaitkan dengan ID yang benar
    data.container = document.getElementById(`${folder}Container`);
    data.indicator = document.getElementById(`${folder}PhotoIndicator`);
    data.spinner = document.getElementById(`${folder}Spinner`);
    
    // Ambil status like dari localStorage saat inisialisasi
    data.liked = localStorage.getItem(getLocalStorageKey(`${folder}_liked`)) === 'true';
    
    // Pastikan container dan indicator kosong saat inisialisasi
    data.container.innerHTML = `<div class="loading-spinner" id="${folder}Spinner"></div>`;
    data.indicator.innerHTML = '';
    
    showPhoto(folder, data.current);
    setupSwipe(data.container, folder);
    setupDoubleTap(data.container, folder); // **TIDAK ADA PERUBAHAN DI SINI**
    startAutoSwipe(folder);
    document.querySelector(`#${folder}Page .album-wrapper`).classList.add('show');
}


function startAutoSwipe(folder){
    clearInterval(autoSwipeInterval);
    autoSwipeInterval = setInterval(() => {
        navPhoto(folder, 1);
    }, 5000); // Ganti foto setiap 5 detik
}

function resetAutoSwipe(folder){
    clearInterval(autoSwipeInterval);
}

function setupSwipe(element, folder){
    let startX;
    element.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        resetAutoSwipe(folder);
    });

    element.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = endX - startX;
        
        if (Math.abs(diff) > 50) { // Geser lebih dari 50px untuk dianggap swipe
            navPhoto(folder, diff < 0 ? 1 : -1); // Swipe kiri (diff < 0) = next
        }
        startAutoSwipe(folder); // Restart auto-swipe setelah interaksi
    });
}

// **FUNGSI BARU: DOUBLE TAP TO LIKE**
function setupDoubleTap(element, folder) {
    element.addEventListener('touchend', (e) => {
        const now = new Date().getTime();
        const timesince = now - lastTap;
        
        // Cek jika tap kedua terjadi dalam 300ms
        if ((timesince < 300) && (timesince > 0)) {
            e.preventDefault(); 
            // Panggil fungsi like
            toggleLike(folder); 
        }
        lastTap = now;
    });
    
    // Tambahkan juga untuk desktop (double click)
    element.addEventListener('dblclick', (e) => {
        e.preventDefault();
        toggleLike(folder); 
    });
}


// Folder Selection Buttons (TIDAK BERUBAH)
document.getElementById('mainAlbumBtn').onclick = ()=>{
    showPage('mainAlbum'); 
    initMainAlbum();
};
document.getElementById('folder1Btn').onclick = ()=>{
    showPage('folder1');
    initFolderAlbum('folder1');
};
document.getElementById('folder2Btn').onclick = ()=>{
    showPage('folder2');
    initFolderAlbum('folder2');
};

// Navbar buttons (DIUBAH)
const chatNavBtn = document.getElementById('chatNavBtn');
chatNavBtn.onclick=()=>showPage('chat'); 
document.getElementById('statusNavBtn').onclick=()=>showPage('status');
document.getElementById('homeBtn').onclick=()=>showPage('home');
document.getElementById('aboutBtn').onclick=()=>showPage('about');
document.getElementById('contactBtn').onclick=()=>showPage('contact');

// Particle (TIDAK BERUBAH)
const particleContainer = document.getElementById('particleContainer');
function createParticle() {
  const p = document.createElement('div');
  p.className = 'particle';
  const size = Math.random() * 5 + 5;
  p.style.width = p.style.height = `${size}px`;
  p.style.left = `${Math.random() * 100}vw`;
  p.style.top = `${Math.random() * 100}vh`;
  p.style.animationDuration = `${Math.random() * 10 + 10}s`;
  p.style.setProperty('--x', `${(Math.random() - 0.5) * 200}px`);
  p.style.setProperty('--y', `${(Math.random() - 0.5) * 200}px`);
  p.style.opacity = Math.random() * 0.5 + 0.1;
  particleContainer.appendChild(p);
  // Hapus partikel setelah animasi selesai (misalnya 20s)
  setTimeout(() => p.remove(), 20000); 
}
for(let i=0;i<50;i++){ createParticle(); }


// Photo menu actions (DIPERBAIKI)
function updateLikeButton(button, isLiked){
    if (!button) return; // Tambahkan pengaman
    const icon = button.querySelector('.icon');
    icon.textContent = isLiked ? 'â¤ï¸' : 'ğŸ¤';
    button.title = isLiked ? 'Unlike' : 'Like';
    button.style.color = isLiked ? '#ff528a' : 'white';
}

function toggleLike(folder){
    const data = albumData[folder];
    data.liked = !data.liked;
    
    // Gunakan likeBtnElement yang sudah dikaitkan
    updateLikeButton(data.likeBtnElement, data.liked);
    
    alert(`Foto ${data.liked ? 'disukai' : 'tidak disukai'}!`);
    // Simpan status like ke localStorage
    localStorage.setItem(getLocalStorageKey(`${folder}_liked`), data.liked);
}

function sharePhoto(folder){
    const data = albumData[folder];
    const photoUrl = data.photos[data.current]; // Ambil URL langsung
    if (navigator.share) {
        navigator.share({
            title: 'Lihat Momen Spesial Ini!',
            text: `Cek foto ini di album digital! Photo ${data.current + 1} dari Folder ${folder}.`,
            url: photoUrl,
        }).catch(error => console.error('Error sharing:', error));
    } else {
        alert('Fitur share tidak didukung di browser ini. Link foto: ' + photoUrl);
    }
}

function downloadPhoto(folder){
    const data = albumData[folder];
    const photoUrl = data.photos[data.current];
    const link = document.createElement('a');
    link.href = photoUrl;
    link.download = `Photo-${folder}-${data.current + 1}.jpg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    alert('Foto sedang diunduh!');
}

// Tambahkan event listeners untuk album utama
document.getElementById('likeBtn').onclick = () => toggleLike('main');
document.getElementById('shareBtn').onclick = () => sharePhoto('main');
document.getElementById('downloadBtn').onclick = () => downloadPhoto('main');
document.getElementById('prevBtn').onclick = () => navPhoto('main', -1);
document.getElementById('nextBtn').onclick = () => navPhoto('main', 1);

// Musik album (TIDAK BERUBAH)
function playMusicIfAlbum(){
  music.play().catch(()=>{}); 
}
document.body.addEventListener('click', ()=>{ music.play(); }, {once:true});


// **CHAT PERSISTENCE & DELETE & MEDIA**
const chatInput = document.getElementById('chatInput');
const sendChatBtn = document.getElementById('sendChatBtn');
const chatMessages = document.getElementById('chatMessages');
const chatStatus = document.getElementById('chatStatus');
const opponentNameEl = document.getElementById('opponentName');
const opponentAvatarEl = document.getElementById('opponentAvatar');
const chatFileInput = document.getElementById('chatFileInput');
const attachMediaBtn = document.getElementById('attachMediaBtn');

function loadChatHistory() {
    const history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
    chatMessages.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8em;">-- Chat hanya berfungsi jika server backend berjalan di localhost:3000 --</div>';
    history.forEach(msg => addMessageToChat(msg, true));
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function saveChatHistory(history) {
    localStorage.setItem(getLocalStorageKey('chatHistory'), JSON.stringify(history));
}

// **FUNGSI BARU: HAPUS CHAT UNTUK SAYA**
function deleteChatMessageForMe(id) {
    if (confirm("Anda yakin ingin menghapus pesan ini HANYA untuk Anda?")) {
        const messageElement = document.getElementById(`msg-${id}`);
        if (messageElement) messageElement.remove();

        let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
        history = history.filter(msg => msg.id != id);
        saveChatHistory(history);
    }
}

// **FUNGSI BARU: HAPUS CHAT UNTUK SEMUA ORANG** (Simulasi)
function deleteChatMessageForEveryone(id) {
    if (confirm("Anda yakin ingin menghapus pesan ini UNTUK SEMUA ORANG? (Simulasi: Pesan akan diganti menjadi 'Pesan ini telah dihapus')")) {
        
        let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
        const index = history.findIndex(msg => msg.id == id);

        if (index !== -1) {
            // Update data di localStorage untuk simulasi
            history[index].message = 'Pesan ini telah dihapus.';
            history[index].media = null;
            history[index].deleted = true; 
            saveChatHistory(history);
            
            // Re-render chat untuk menampilkan perubahan (simulasi)
            loadChatHistory();
            
            // Broadcast ke server untuk diupdate di sisi lawan (perlu implementasi di backend)
            socket.emit('delete_message_for_everyone', { id: id, senderId: myUserId });
        }
    }
}

// **FUNGSI BARU: HIDE DELETE OPTIONS**
document.addEventListener('click', (e) => {
    document.querySelectorAll('.delete-options').forEach(menu => {
        if (!menu.contains(e.target) && !e.target.closest('.delete-chat-menu')) {
            menu.style.display = 'none';
        }
    });
});


function updateChatHeader(usersData) {
    const opponentId = myUserId === 'zaza' ? 'khirza' : 'zaza';
    opponentInfo = usersData[opponentId] || CHAT_USER_PROFILES[opponentId];
    
    if (opponentInfo) {
        opponentNameEl.innerHTML = opponentInfo.name + (opponentInfo.isVerified ? ' <span class="material-icons" style="font-size: 1em; color: #7aff7a; vertical-align: middle;">verified</span>' : '');
        opponentAvatarEl.textContent = opponentInfo.avatar;
    }
}

// FUNGSI CHAT DENGAN MEDIA (DIUBAH UNTUK MENU HAPUS)
function addMessageToChat(data, isHistory = false) {
    const { message, media, timestamp, senderId, status, id, deleted } = data; // Tambah 'deleted'
    const isMe = senderId === myUserId;
    const messageId = id || Date.now();
    const timeDisplay = timestamp || new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

    const msgDiv = document.createElement('div');
    msgDiv.classList.add('chat-bubble');
    msgDiv.id = `msg-${messageId}`;

    // Inline CSS untuk gelembung chat (DITAMBAH margin-bottom)
    msgDiv.style.cssText = `
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 15px;
        color: ${isMe ? 'white' : '#333'};
        word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        font-size: 0.95em;
        line-height: 1.4;
        align-self: ${isMe ? 'flex-end' : 'flex-start'};
        background: ${isMe ? '#ff99c7' : 'rgba(255,255,255,0.85)'};
        border-bottom-${isMe ? 'right' : 'left'}-radius: 0;
        margin-bottom: 10px;
        display: inline-block; /* Agar bisa menampung media dengan baik */
        opacity: ${deleted ? 0.7 : 1}; /* Jika dihapus, agak transparan */
    `;

    let contentHTML = '';
    let isDeletedMessage = deleted && message === 'Pesan ini telah dihapus.';

    if (isDeletedMessage) {
        contentHTML = `<em style="color: ${isMe ? 'white' : '#777'}; font-size: 0.9em;">${message}</em>`;
    } else if (media) {
        // Konten media, pastikan media-message memiliki styling yang benar
        contentHTML += `<img src="${media}" class="media-message" alt="Media File" style="max-width: 180px; max-height: 180px; display: block; border-radius: 8px;">`;
        if (message) {
            contentHTML += `<div style="margin-top: 5px; font-style: italic;">${message}</div>`; // Caption
        }
    } else {
        contentHTML += message;
    }

    // Status dan Time hanya ditampilkan jika pesan tidak dihapus
    const statusAndTimeHTML = isDeletedMessage ? '' : `
        <span style="display: block; font-size: 0.75em; margin-top: 5px; text-align: right; color: ${isMe ? 'rgba(255,255,255,0.8)' : 'rgba(0,0,0,0.6)'};">
            ${timeDisplay}
            ${isMe ? `<span class="material-icons message-status" data-id="${messageId}" style="font-size: 1em; margin-left: 3px; vertical-align: middle; color: ${status === 'read' ? '#00e676' : 'rgba(255,255,255,0.8)'};">${status === 'read' ? 'done_all' : (status === 'sent' ? 'done_all' : 'schedule')}</span>` : ''}
        </span>
    `;

    // Tombol Hapus (Hanya muncul jika isMe dan TIDAK dihapus)
    const deleteMenuHTML = (isMe && !isDeletedMessage) ? `
        <button class="delete-chat-menu" onclick="event.stopPropagation(); this.nextElementSibling.style.display = 'block';">
            <span class="material-icons" style="font-size: 14px;">more_vert</span>
        </button>
        <div class="delete-options">
            <button onclick="deleteChatMessageForMe('${messageId}')">
                <span class="material-icons" style="font-size: 1em; color:#333;">delete</span> Hapus untuk Saya
            </button>
            <button onclick="deleteChatMessageForEveryone('${messageId}')">
                <span class="material-icons" style="font-size: 1em; color:red;">delete_forever</span> Hapus untuk Semua
            </button>
        </div>
    ` : '';


    // Konten Pesan + Jam + Status (Centang) + Tombol Hapus (DITAMBAH)
    msgDiv.innerHTML = `
        ${contentHTML}
        ${statusAndTimeHTML}
        ${deleteMenuHTML}
    `;

    chatMessages.appendChild(msgDiv);
    if (!isHistory) chatMessages.scrollTop = chatMessages.scrollHeight;
}

function updateMessageStatus(data) {
    const statusIcon = document.querySelector(`.message-status[data-id="${data.id}"]`);
    if (statusIcon) {
        if (data.status === 'read') {
            statusIcon.textContent = 'done_all';
            statusIcon.style.color = '#00e676';
        } else if (data.status === 'sent') {
            statusIcon.textContent = 'done_all';
            statusIcon.style.color = 'rgba(255,255,255,0.8)';
        }
    }
}

// --- SOCKET LISTENERS (DIUBAH UNTUK PERSISTENCE & DELETE) ---
socket.on('load_users', (usersData) => { updateChatHeader(usersData); });
socket.on('load_history', () => { loadChatHistory(); }); 
socket.on('receive_message', (data) => { 
    data.id = data.id || Date.now();
    addMessageToChat(data); 

    let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
    history.push(data);
    saveChatHistory(history);
});

socket.on('update_status', (data) => { updateMessageStatus(data); });
socket.on('user_status_update', (onlineIds) => {
    const opponentId = myUserId === 'zaza' ? 'khirza' : 'zaza';
    
    if (onlineIds.includes(opponentId)) {
        chatStatus.textContent = 'Online âœ¨';
        chatStatus.style.color = '#7aff7a';
    } else {
        chatStatus.textContent = 'Offline ğŸ˜´';
        chatStatus.style.color = '#ffc0de';
    }
});

// **BARU: LOGIKA SIMULASI HAPUS CHAT DARI LAWAN**
socket.on('message_deleted_for_everyone', (data) => {
    const { id } = data;
    
    let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
    const index = history.findIndex(msg => msg.id == id);
    
    if (index !== -1) {
        // Cek apakah pesan ini dikirim oleh lawan bicara (bukan saya)
        if (history[index].senderId !== myUserId) {
             history[index].message = 'Pesan ini telah dihapus oleh pengirim.';
             history[index].media = null;
             history[index].deleted = true;
             saveChatHistory(history);
             loadChatHistory(); // Re-render
        }
    }
});


// LOGIKA PENGIRIMAN MEDIA CHAT (DITAMBAH)
attachMediaBtn.addEventListener('click', () => {
    chatFileInput.click();
});

chatFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const mediaUrl = event.target.result;
            const caption = prompt("Tambahkan Caption (Opsional):") || "";

            const messageData = {
                senderId: myUserId,
                message: caption,
                media: mediaUrl, // Kirim media
                timestamp: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                status: 'pending', 
                id: Date.now() 
            };

            socket.emit('send_message', messageData);
            
            let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
            history.push(messageData);
            saveChatHistory(history);

            addMessageToChat(messageData);
            chatFileInput.value = ''; // Reset input
        };
        reader.readAsDataURL(file);
    }
});


// --- EVENT HANDLER CHAT INPUT (DIUBAH) ---
sendChatBtn.addEventListener('click', () => {
    const message = chatInput.value.trim();
    if (message !== '' && myUserId) {
        const messageData = {
            senderId: myUserId,
            message: message,
            media: null, // Pastikan media null jika hanya teks
            timestamp: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
            status: 'pending', 
            id: Date.now() 
        };

        socket.emit('send_message', messageData);
        
        let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
        history.push(messageData);
        saveChatHistory(history);

        addMessageToChat(messageData);
        
        chatInput.value = '';
    }
});
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendChatBtn.click();
});


// **FITUR STATUS (STORIES) MEDIA & HAPUS**
const createMediaStatusBtn = document.getElementById('createMediaStatusBtn');
const statusFileInput = document.getElementById('statusFileInput');
const statusListEl = document.getElementById('statusList');


// Logika memicu pemilihan file untuk Status (DITAMBAH)
createMediaStatusBtn.addEventListener('click', () => {
    statusFileInput.click();
});

// Logika menyimpan Status Media (DITAMBAH)
statusFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const mediaUrl = event.target.result;
            const caption = prompt("Tambahkan Caption (Opsional):") || "";

            const statusData = {
                id: Date.now(),
                senderId: myUserId,
                senderName: myUserName,
                message: caption,
                media: mediaUrl, // Simpan URL media
                timestamp: new Date().toLocaleString('id-ID'),
                likes: [], 
                viewers: []
            };
            
            let allStatuses = JSON.parse(localStorage.getItem(STATUS_KEY) || '[]');
            allStatuses.unshift(statusData); 
            localStorage.setItem(STATUS_KEY, JSON.stringify(allStatuses));
            renderStatusList();
            statusFileInput.value = ''; // Reset input
        };
        reader.readAsDataURL(file);
    }
});

// **FUNGSI BARU: HAPUS STATUS**
window.deleteStatus = function(statusId, event) {
    event.stopPropagation(); // Mencegah klik menyebar ke viewStatus
    if (confirm("Anda yakin ingin menghapus status ini?")) {
        let allStatuses = JSON.parse(localStorage.getItem(STATUS_KEY) || '[]');
        allStatuses = allStatuses.filter(s => s.id !== statusId);
        localStorage.setItem(STATUS_KEY, JSON.stringify(allStatuses));
        renderStatusList(); 
        alert("Status berhasil dihapus.");
    }
}


// Fungsi untuk menampilkan daftar status (DIPERBARUI DENGAN TOMBOL HAPUS)
function renderStatusList() {
    statusListEl.innerHTML = '';
    const allStatuses = JSON.parse(localStorage.getItem(STATUS_KEY) || '[]');
    
    if (allStatuses.length === 0) {
        statusListEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 0.9em;">Belum ada status.</div>';
        return;
    }
    
    const groupedStatuses = {};
    allStatuses.forEach(status => {
        if (!groupedStatuses[status.senderId]) {
            groupedStatuses[status.senderId] = [];
        }
        groupedStatuses[status.senderId].push(status);
    });

    const sortedGroups = Object.keys(groupedStatuses).sort((a, b) => {
        if (a === myUserId) return -1;
        if (b === myUserId) return 1;
        return 0;
    });

    sortedGroups.forEach(senderId => {
        const group = groupedStatuses[senderId];
        const latestStatus = group[0]; 
        const isMyStatus = senderId === myUserId;
        const isViewedByMe = latestStatus.viewers.includes(myUserId);
        
        const item = document.createElement('div');
        item.classList.add('status-item');
        item.setAttribute('data-id', latestStatus.id);
        
        if (isViewedByMe) {
            item.classList.add('viewed');
        }
        
        // Klik pada item akan menampilkan status paling baru di grup tersebut
        item.onclick = () => viewStatus(latestStatus.id); 
        
        // Tampilkan Teks/Media di daftar Status
        const previewText = latestStatus.message.substring(0, 40) + (latestStatus.message.length > 40 ? '...' : '');

        const preview = latestStatus.media 
            ? `<span class="material-icons" style="font-size:0.9em; vertical-align:middle; margin-right: 5px;">image</span> ${previewText || 'Media Status'}`
            : previewText;

        // **TAMBAHKAN TOMBOL HAPUS STATUS JIKA ITU STATUS SAYA**
        const deleteButton = isMyStatus ? `
            <button class="delete-status-btn" onclick="deleteStatus(${latestStatus.id}, event)">
                <span class="material-icons" style="font-size: 14px;">close</span>
            </button>
        ` : '';

        item.innerHTML = `
            ${deleteButton}
            <div style="font-weight:700; color: #ffe3f1;">
                ${isMyStatus ? 'Status Saya' : latestStatus.senderName} 
            </div>
            <p style="margin:5px 0 0; font-size:1em; opacity: 0.9;">${preview}</p>
            <div class="status-meta">
                <span>${latestStatus.timestamp}</span>
                ${isMyStatus ? 
                    `<span class="viewed-icon">
                        <span class="material-icons" style="font-size:0.9em;">visibility</span> 
                        ${latestStatus.viewers.length} Dilihat
                    </span>`
                    : (isViewedByMe ? '' : '<span>Belum Dilihat</span>')
                }
            </div>
        `;
        
        statusListEl.appendChild(item);
    });
}

// Fungsi untuk melihat status (dengan Media Viewer)
function viewStatus(id) {
    let allStatuses = JSON.parse(localStorage.getItem(STATUS_KEY) || '[]');
    const index = allStatuses.findIndex(s => s.id === id);
    if (index === -1) return;

    let status = allStatuses[index];
    currentStatusId = id;
    
    // Media Viewer Element
    const viewerMediaEl = document.getElementById('viewerMedia');

    // Tampilkan Media jika ada
    if (status.media) {
        viewerMediaEl.src = status.media;
        viewerMediaEl.style.display = 'block';
    } else {
        viewerMediaEl.src = '';
        viewerMediaEl.style.display = 'none';
    }

    // LOGIKA IKON MATA: Tambahkan user ke daftar viewers jika belum dilihat
    if (status.senderId !== myUserId && !status.viewers.includes(myUserId)) {
        status.viewers.push(myUserId);
        allStatuses[index] = status;
        localStorage.setItem(STATUS_KEY, JSON.stringify(allStatuses));
        renderStatusList(); // Refresh daftar Status agar ikon mata muncul
    }
    
    document.getElementById('viewerSender').textContent = status.senderId === myUserId ? 'Anda' : status.senderName;
    document.getElementById('viewerTime').textContent = `(${status.timestamp})`;
    document.getElementById('viewerMessage').textContent = status.message;
    document.getElementById('likeCount').textContent = status.likes.length;
    document.getElementById('viewCount').textContent = status.viewers.length;

    const likeBtn = document.getElementById('statusLikeBtn');
    const isLiked = status.likes.includes(myUserId);
    likeBtn.style.background = isLiked ? '#ff528a' : '#ff99c7';
    likeBtn.textContent = isLiked ? 'Unlike' : 'Like';

    const replyBtn = document.getElementById('statusReplyBtn');
    const replySection = document.getElementById('replySection');
    const likeDiv = document.getElementById('statusLikeBtn');
    
    if (status.senderId === myUserId) {
        replyBtn.style.display = 'none';
        replySection.style.display = 'none';
        likeDiv.style.display = 'none';
    } else {
        replyBtn.style.display = 'inline-block';
        likeDiv.style.display = 'inline-block';
        replySection.style.display = 'none'; 
    }
    
    document.getElementById('statusViewer').style.display = 'flex';
}

// Handler Like Status
document.getElementById('statusLikeBtn').addEventListener('click', () => {
    if (!currentStatusId) return;

    let allStatuses = JSON.parse(localStorage.getItem(STATUS_KEY) || '[]');
    const index = allStatuses.findIndex(s => s.id === currentStatusId);

    if (index !== -1) {
        let status = allStatuses[index];
        const isLiked = status.likes.includes(myUserId);

        if (isLiked) { status.likes = status.likes.filter(id => id !== myUserId); } 
        else { status.likes.push(myUserId); }

        allStatuses[index] = status;
        localStorage.setItem(STATUS_KEY, JSON.stringify(allStatuses));
        viewStatus(currentStatusId); 
        renderStatusList(); 
    }
});

// Handler Reply Status (Tampilkan input)
document.getElementById('statusReplyBtn').addEventListener('click', () => { document.getElementById('replySection').style.display = 'flex'; });

// Handler Kirim Reply
document.getElementById('sendReplyBtn').addEventListener('click', () => {
    const replyInput = document.getElementById('statusReplyInput');
    const replyText = replyInput.value.trim();
    
    if (replyText === '') return;

    let allStatuses = JSON.parse(localStorage.getItem(STATUS_KEY) || '[]');
    const statusIndex = allStatuses.findIndex(s => s.id === currentStatusId);
    
    if (statusIndex !== -1) {
        const originalStatus = allStatuses[statusIndex];
        
        const messageData = {
            senderId: myUserId,
            message: `[REPLY STATUS dari ${myUserName} ke ${originalStatus.senderName}: "${originalStatus.message.substring(0, 15)}..."] ${replyText}`,
            media: null,
            timestamp: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
            status: 'pending', 
            id: Date.now() 
        };

        // Kirim pesan ke chat (simulasi)
        socket.emit('send_message', messageData);
        
        let history = JSON.parse(localStorage.getItem(getLocalStorageKey('chatHistory')) || '[]');
        history.push(messageData);
        saveChatHistory(history);
        
        alert(`Balasan Anda berhasil dikirim ke ${originalStatus.senderName} melalui Chat!`);
        
        replyInput.value = '';
        document.getElementById('statusViewer').style.display = 'none';
    }
});
</script>
</body>
</html>

